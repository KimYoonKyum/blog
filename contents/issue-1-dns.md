---
date: '2023-02-23'
title: '오늘의 이슈'
categories: ['Browser', 'DNS']
summary: 'DNS 관련 이슈'
thumbnail: './images/issue-logo.png'
---

# 문제 발생
- 아침에 출근 중에 갑자기 네이버에서 검색해서 홈페이지 접속 했을 때 에러가 난다고 운영팀에서 문의가 들어왔다.
- 최초에 문의 받은 사진은 아래와 같다
![KakaoTalk_Photo_2023-02-23-22-02-03](https://user-images.githubusercontent.com/21151247/220913900-c079c26c-b26b-427e-978a-0df9b1e1fe7e.jpeg)

# 문제 해결 단계
- 일단 네이버에서 검색해서 들어 갔을때 저런 화면이 뜬다는 것은 홈 화면에서 에러가 난다고 생각했다.
- 만약 vercel쪽 문제 이거나 프론트엔드 코드에서 문제라면 서버 api 호출 없는 ~/login 화면도 에러가 나겠지 생각하고 로그인 화면을 접근 해 보았을 때, 문제가 없었다
- 브라우저/포스트맨에서 api 호출하면 아예 response가 오지도 않았다. 
- 2주 동안 프론트 코드는 마케팅 툴 작업 이외에 로직 건드린 것은 없었기에 바로 서버에 확인 요청을 했다.
- 서버도 문제가 없다고 해서 서버팀에서 작업 한 API doc에 들어가 확인해 보았다.
- API doc에서 호출 했을때 잘되기도 하다가 안되기도 하고 결정적으로 해당 도메인에 **'DNS_PROBE_FINISHED_NXDOMAIN'** 이러한 문구가 뜨면서 접속이 안되었다.
- 바로 검색해보니 해당 에러 메세지는 크롬에서 발생하는 오류 메세지 였고 DNS에서 실제 주소를 못찾고 있는 상황 이라는 것을 확인 했다.
- 일단 인프라 관리 하시는 서버 개발자 분 한테 확인을 요청 하니 놀랍게도 DNS 서버 결제가 제때 이루어 지지 않아 주소가 갱신이 안되고 있었던 것이었다(결제용 카드가 유효하지 않았다)..........
- 몹시 분노하신 CTO님(들어온지 얼마안되신)께 보고 드리고 이런 설정과 관리는 공용 계정으로 담당자를 확실하게 지정하도록 지시 받았고, 도메인, SSL 인증서, 라이센스 등은 만기 전에 미리 확인 해서 연장하거나 결제 될 수 있도록 조치 시키셨다.

# 아쉬웠던 점
- 사실 프론트 팀에서는 확인 정도 밖에 할 일이 없었다.
- 그렇지만 확인하는 과정에서 에러 발생한 디바이스 정보, 언제부터 발생했는지 발생 시각, 정확한 nextjs에서 서버사이드에서 데이터 페치 할때 어떤 API에서 에러 났는지 등 정확한 에러 발생 환경을 빠르게 파악하지 못한 점이 아쉬웠다
- 혹시나 이런 에러 발생 시에 써먹을 수 있는 툴들이 있나 찾아보니 에러 로그 수집기 라는 Sentry 라는 것이 있었다.
- Sentry를 통해서 에러 발생 디바이스 정보와 발생 시각, 리플레이, 개발자가 지정한 에러 등을 한눈에 로그 처럼 볼 수 있었다.
- 설정이 그렇게 어려운 것 같지 않으나 유/무료 버전이 있다. 슬랙과도 연동이 되고 좋은거 같다. 한번 주말에 적용해 보고 실제 서비스에 적용 할 수 있는지 제안을 해봐야 겠다.

# Source
- aws
  - [<https://aws.amazon.com/ko/premiumsupport/knowledge-center/route-53-troubleshoot-nxdomain-responses/>](<https://aws.amazon.com/ko/premiumsupport/knowledge-center/route-53-troubleshoot-nxdomain-responses/>)
- sentry
  - [<https://sentry.io/welcome/>](<https://sentry.io/welcome/>)